<!doctype html>

<style>
    #byte_content {
        margin: 5px 0;
        max-height: 100px;
        overflow-y: auto;
        overflow-x: hidden;
    }

    #byte_range {
        margin-top: 5px;
    }
</style>

<html>

<head>
    <title>This is the title of the webpage!</title>
</head>

<body>
    <input type="file" id="files" name="file" /> Read bytes:
    <span class="readBytesButtons">
        <button>entire file</button>
    </span>
</body>

<script src="/src/js/decoder.js">
    console.log(this);
</script>

<script>
    console.log(this);
    function parseFile(file, callback) {
        var fileSize = file.size;
        var chunkSize = 64 * 1024; // bytes
        var offset = 0;
        var chunkReaderBlock = null;

        var readEventHandler = function (evt) {
            if (evt.target.error == null) {
                offset += evt.target.result.byteLength;
                console.log(evt.target.result, offset, fileSize);
                //callback(evt.target.result); // callback for handling read chunk
            } else {
                console.log("Read error: " + evt.target.error);
                return;
            }
            if (offset >= fileSize) {
                console.log("Done reading file");
                return;
            }

            // of to the next chunk
            chunkReaderBlock(offset, chunkSize, file);
        }

        chunkReaderBlock = function (_offset, length, fd) {
            const r = new FileReader();
            const blob = fd.slice(_offset, length + _offset);
            r.onload = readEventHandler;
            r.readAsArrayBuffer(blob);
        }

        // now let's start the read with the first block
        chunkReaderBlock(offset, chunkSize, file);
    }

    document.querySelector('.readBytesButtons').addEventListener('click', evt => {
        const files = document.getElementById('files').files;
        if (files && files.length) {
            parseFile(files[0]);
        }
    }, false);
</script>

</html>
